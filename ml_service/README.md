# ML-микросервис

Технологический стек: Python, PyTorch, FastAPI, Docker

## Решение задачи сегментаци добавленного товара

Для сравнения были выделены следующие подходы: 
1. [SSIM (Structural SIMilarity index)](https://scikit-image.org/docs/stable/auto_examples/transform/plot_ssim.html) 
2. [ChangeNet](https://github.com/leonardoaraujosantos/ChangeNet) 
3. [ChangeFormer](https://github.com/wgcban/ChangeFormer)

Таблица с результатами экспериментов:

| Название подхода | IOU на тестовой выборке | Среднее время инференса на CPU для одного сэмпла, мс | Среднее время инференса на GPU для одного сэмпла, мс |
|-------------------|--------------------------|-----------------------------------------------------|-----------------------------------------------------|
| SSIM             | 0,3702                  | 31,4                                                | 17,9                                                |
| ChangeNet        | 0,5653                  | 107,1                                               | 48,3                                                |
| ChangeFormer     | **0,8522**              | 61,5                                                | 60,9                                                |

**ChangeFormer** показал лучшие результаты на тестовой выборке IOU=0,8522, среднее время инференса на одном сэмпле на CPU и GPU почти равно и составляет 61,5 мс и 60,9 мс соответственно.

## Решение задачи идентификации добавленного товара

Для сравнения были выделены несколько разновидностей MobileNet, ResNet, EfficientNet

Таблица с результатами экспериментов:

| Модель                | Картофель | Капуста белокочанная | Cвекла | Минтай | Лук репчатый | Mean F1-score |
|-----------------------|------------|---------------------|---------|---------|---------------|---------------|
| MobileNetV2          | **0,995**      | 0,9796             | **0,98**    | 0,9585  | **0,9981**        | **0,9822**       |
| MobileNetV3_small    | 0,985      | 0,9691             | 0,9485  | 0,9697  | 0,9749        | 0,9694       |
| MobileNetV3_large    | 0,99       | **0,9848**         | 0,9485  | **0,9698** | 0,9949        | 0,9776        |
| ResNet18             | 0,97       | 0,9691             | 0,8913  | 0,8913  | 0,9588        | 0,9361        |
| ResNet34             | 0,97       | 0,9798             | 0,9388  | 0,8539  | 0,9634        | 0,9412       |
| ResNet50             | 0,992      | 0,9796             | 0,9375  | 0,9485  | 0,9348        | 0,9585       |
| EfficientNetB2       | 0,967      | 0,9694             | 0,9032  | 0,9697  | 0,9798        | 0,9578       |
| EfficientNetB3       | 0,965      | 0,9583             | 0,9592  | 0,9495  | 0,9741        | 0,9612       |
| EfficientNetB4       | 0,9398     | 0,9534             | 0,9485  | 0,96    | 0,9846        | 0,9573       |

Таблица со средним временем инференса моделей на CPU и GPU

| Модель                | Среднее время инференса одного изображения на CPU, мс | Среднее время инференса одного изображения на GPU, мс |
|-----------------------|------------------------------------------------------|------------------------------------------------------|
| MobileNetV2          | **21,4**                                                | 5,9                                                  |
| MobileNetV3_small    | **9,2**                                                 | **4,8**                                                  |
| MobileNetV3_large    | **16**                                                  | 5,7                                                  |
| ResNet18             | 21,6                                                | **2,4**                                                  |
| ResNet34             | 38,3                                                | **3,8**                                                  |
| ResNet50             | 61                                                  | 5,5                                                  |
| EfficientNetB2       | 44,1                                                | 9,9                                                  |
| EfficientNetB3       | 58,6                                                | 11,2                                                 |
| EfficientNetB4       | 80,8                                                | 14                                                   |

В результате экспериментов лучшее среднее значение F1-score = 0,9822 на тестовой выборке показала модель архитектуры **MobilenetV2**, которая к тому же вошла в топ-3 быстрых по инференсу на CPU, её среднее время инференса на CPU составило 21,4 мс.